<!DOCTYPE html>
<html>
    <head>
        <title>Set</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="test.css">
        <script type="module">

import { test } from "./test.js";
import { html, K, timeout } from "../lib/util.js";
import { Instant, Seq, Set, dump } from "../lib/score.js";
import { Tape } from "../lib/tape.js";
import { Deck } from "../lib/deck.js";

test("Set(target, property)", t => {
    const object = {};
    const set = Set(object, "src");
    t.equal(set.show(), "Set<src>", "show");
    t.equal(set.duration, 0, "zero duration");
    t.equal(!set.fallible, true, "not fallible");
});

test("Instantiation (Element target)", t => {
    const tape = Tape();
    const deck = Deck({ tape });
    const image = html("img", { src: "foo.png" });
    const instance = tape.instantiate(Seq(
        Instant(K("bar.jpg")),
        Set(image, "src").dur(23)
    ), 17);
    deck.now = 18;
    t.match(image.src, /\/bar.jpg$/, "attribute was set");
    deck.now = 41;
    t.match(image.src, /\/foo.png$/, "attribute was reset");
    t.equal(dump(instance),
`* Seq-0 [17, 40[ <bar.jpg>
  * Instant-1 @17 <bar.jpg>
  * Set-2 [17, 40[ <bar.jpg>`, "dump matches");
});

test("Instantiation (Element target, static value)", t => {
    const tape = Tape();
    const deck = Deck({ tape });
    const image = html("img", { src: "foo.png" });
    const instance = tape.instantiate(Set(image, "src", "bar.jpg").dur(23), 17);
    deck.now = 18;
    t.match(image.src, /\/bar.jpg$/, "attribute was set");
    deck.now = 41;
    t.match(image.src, /\/foo.png$/, "attribute was reset");
    t.equal(dump(instance), "* Set-0 [17, 40[ <bar.jpg>", "dump matches");
});

        </script>
    </head>
    <body>
        <p><a href="index.html">Back</a></p>
    </body>
</html>
