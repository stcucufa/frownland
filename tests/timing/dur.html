<!DOCTYPE html>
<html>
    <head>
        <title>Dur modifier</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { test } from "../test.js";
import { K } from "../../lib/util.js";
import { Instant, Delay, Seq, Par } from "../../lib/timing.js";
import { VM } from "../../lib/runtime.js";

test("Seq.dur(), cutoff", t => {
    const vm = VM();
    const seq = vm.add(Seq(Delay(23), (x, t) => t * (x ?? 2)).dur(19), 17);
    vm.clock.seek(37);
    t.undefined(seq.value, "no value");
    t.equal(seq.timeout, 36, "timed out");
    t.equal(seq.dump(),
`+ 17/0 [begin] Seq
* 17/1 Delay(23)
* 40/2 Instant
* 36/3 [end] Seq`, "dump matches");
});

test("Par.dur(), cutoff", t => {
    const vm = VM();
    const par = vm.add(Seq(
        K(7),
        Par(
            Seq(Delay(23), (x, t) => t * (x ?? 2)),
            (x, t) => t + (x ?? 3)
        ).dur(19)
    ), 17);
    vm.clock.seek(37);
    t.equal(par.value, 7, "Par input value");
    t.equal(par.timeout, 36, "timed out");
    t.equal(par.dump(),
`+ 17/0 [begin] Seq
* 17/0 Instant
* 17/1 [begin] Par
    + 17/0 [begin] Seq
    * 17/0 Delay(23)
    * 40/1 Instant
    * 40/2 [end] Seq
    + 17/0 Instant
* 36/6 [end] Par
* 36/6 [end] Seq`, "dump matches");
});

        </script>
    </head>
    <body>
        <p><a href="../index.html">Back</a></p>
    </body>
</html>
