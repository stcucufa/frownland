<!DOCTYPE html>
<html>
    <head>
        <title>Delay</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { test } from "../test.js";
import { Delay } from "../../lib/timing.js";

test("Delay(duration)", t => {
    const instant = Delay(23);
    t.equal(instant.tag, "Delay", "tag");
    t.equal(instant.duration, 23, "duration");
    t.equal(Delay("1mn30s").duration, 90000, "duration string");
    t.equal(Delay("long").duration, 0, "invalid duration (0)");
});

test("Code generation", t => {
    const delay = Delay(23);
    const thread = { stack: [null], ops: [[17]] };
    delay.generate(thread);
    t.equal(thread.ops.length, 2, "Execution with duration");
    t.equal(thread.ops[0].length, 2, "Begin instruction");
    t.equal(thread.ops[0][1](thread), delay, "Op for begin");
    t.equal(thread.ops[1].length, 2, "End instruction");
    t.equal(thread.ops[1][0], 40, "End time");
    t.equal(thread.ops[1][1](thread), delay, "Op for end");
    t.equal(thread.stack, [null], "Stack is untouched");
});

test("Code generation (zero duration)", t => {
    const delay = Delay("zero");
    const thread = { stack: [null], ops: [[17]] };
    delay.generate(thread);
    t.equal(thread.ops, [[17]], "No new instruction");
});

        </script>
    </head>
    <body>
        <p><a href="../index.html">Back</a></p>
    </body>
</html>
