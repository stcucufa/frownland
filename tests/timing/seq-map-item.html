<!DOCTYPE html>
<html>
    <head>
        <title>Seq.map (item)</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { test } from "../test.js";
import { K } from "../../lib/util.js";
import { Tape } from "../../lib/tape.js";
import { Deck } from "../../lib/deck.js";
import { Delay, Event, Instant, Par, Seq } from "../../lib/timing.js";
import { dump } from "../../lib/timing/util.js";

test("Seq.map(child)", t => {
    const child = Instant();
    const map = Seq.map(child);
    t.equal(map.show(), "Seq/map", "show");
    t.equal(map.child, child, "child item");
    t.undefined(map.duration, "unresolved duration");
    t.equal(map.take(0).duration, 0, "down to zero with take(0)");
    t.equal(!map.fallible, true, "not fallible");
});

test("Seq.map(child).repeat()", t => {
    const seq = Seq.map(Instant());
    const repeat = seq.repeat();
    t.equal(repeat.show(), "Seq/repeat", "show");
    t.equal(repeat.child, seq, "repeat child");
    t.equal(repeat.duration, Infinity, "indefinite duration");
    t.equal(!repeat.fallible, true, "not fallible");
    t.undefined(repeat.take(3).duration, "repeat dur (limited)");
});

test("Instantiation", t => {
    const tape = Tape();
    const seq = tape.instantiate(Seq(
        Instant(K([31, 19, 23])),
        Seq.map(Instant(x => x * 2).dur(41))
    ), 17);
    Deck({ tape }).now = 141;
    t.equal(dump(seq),
`* Seq-0 [17, 140[ <62,38,46>
  * Instant-1 @17 <31,19,23>
  * Seq/map-2 [17, 140[ <62,38,46>
    * Seq-3 [17, 58[ <62>
      * Delay-4 [17, 58[ <31>
      * Instant-5 @58 <62>
    * Seq-6 [58, 99[ <38>
      * Delay-7 [58, 99[ <19>
      * Instant-8 @99 <38>
    * Seq-9 [99, 140[ <46>
      * Delay-10 [99, 140[ <23>
      * Instant-11 @140 <46>`, "dump matches");
});

test("Instantiation; empty input array", t => {
    const tape = Tape();
    const seq = tape.instantiate(Seq(Instant(K([])), Seq.map(Instant())), 17);
    Deck({ tape }).now = 91;
    t.equal(seq.value, [], "empty list");
});

        </script>
    </head>
    <body>
        <p><a href="../index.html">Back</a></p>
    </body>
</html>
