<!DOCTYPE html>
<html>
    <head>
        <title>Scene Graph Node</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { test } from "../test.js";
import { Node } from "../../lib/scene-graph/node.js";

test("Node()", t => {
    const node = Node();
    t.equal(node.children, [], "no children");
    t.equal(node.x, 0, "position (x)");
    t.equal(node.y, 0, "position (y)");
    t.equal(node.width, 0, "size (width)");
    t.equal(node.height, 0, "size (height)");
});

test("Node({ properties })", t => {
    const node = Node({ x: 100, width: 200, height: 300 });
    t.equal(node.children, [], "no children");
    t.equal(node.x, 100, "position (x)");
    t.equal(node.y, 0, "position (y, default)");
    t.equal(node.width, 200, "size (width)");
    t.equal(node.height, 300, "size (height)");
    const p = Node({ children: [node] });
    t.equal(p.children, [node], "node with children");
    t.equal(node.parent, p, "children parent is set");
});

test("Node.appendChild(child)", t => {
    const p = Node();
    const c = Node();
    t.equal(p.appendChild(c), c, "return the added child");
    t.equal(p.children, [c], "child was added");
    t.equal(c.parent, p, "parent is set on child");
    const d = p.appendChild(Node());
    t.equal(p.children, [c, d], "child is added at the end");
    const q = Node();
    q.appendChild(c);
    t.equal(p.children, [d], "child is removed if added to a different node");
    t.equal(c.parent, q, "parent is updated on child");
});

test("Node.remove()", t => {
    const p = Node();
    const c = p.appendChild(Node());
    t.equal(c.remove(), c, "return the node");
    t.equal(p.children, [], "node was removed from parent");
    t.undefined(c.parent, "parent is unset");
});

test("Node.renderAt(renderer, x, y)", t => {
    const renderer = {
        rendering: [],
        renderNodeAt(node, x, y) {
            this.rendering.push([node, x, y]);
        }
    };

    const node = Node({ x: 100, children: [Node({ y: 25 })] });
    node.renderAt(renderer, 50, -50);
    t.equal(renderer.rendering, [
        [node, 150, -50],
        [node.children[0], 150, -25]
    ], "rendered the node as expected");
});

        </script>
    </head>
    <body>
        <p><a href="../index.html">Back</a></p>
    </body>
</html>
