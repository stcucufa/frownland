<!DOCTYPE html>
<html>
    <head>
        <title>Tomato</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { html, K, range } from "../../lib/util.js";
import { Tape } from "../../lib/tape.js";
import { Deck } from "../../lib/deck.js";
import { Element, Instant, Par, Score, Seq, Set } from "../../lib/timing.js";
import { dump } from "../../lib/timing/util.js";

const FPS = 9;
const dur = 1000 / FPS;

const tape = Tape();
const deck = Deck({ tape });
const score = Score({ tape });

const image = html("img");
const frame = html("p");

score.add(Par(
    Element(image).dur(Infinity),
    Element(frame).dur(Infinity),
    Seq(
        Instant(K([...range(1, 18)])),
        Seq.map(Par(
            Seq(
                Instant(i => `tomato${i.toString().padStart(2, "0")}.png`),
                Set(image, "src").dur(dur)
            ),
            Set(frame, "textContent").dur(dur)
        ))
    ).repeat()
));

deck.start();

window.$ = () => { console.log(dump(score.instance)); };

        </script>
    </head>
    <body>
    </body>
</html>
