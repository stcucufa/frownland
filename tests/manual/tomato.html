<!DOCTYPE html>
<html>
    <head>
        <title>Tomato</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <script type="module">

import { html, K, range } from "../../lib/util.js";
import { Tape } from "../../lib/tape.js";
import { Deck } from "../../lib/deck.js";
import { Element, first, Instant, Repeat, Score, Seq, Set } from "../../lib/timing.js";
import { dump } from "../../lib/timing/util.js";

const FPS = 9;

const tape = Tape();
const deck = Deck({ tape });
const score = Score({ tape });

const image = html("img");
const frame = document.querySelector("span");

score.add(Element(image).dur(Infinity));
score.add(Repeat(Seq(
    Instant(K([...range(1, 18)])),
    Seq.map(first(
        Seq(
            Instant(i => `tomato${i.toString().padStart(2, "0")}.png`),
            Set(image, "src").dur(1000 / FPS)
        ),
        Set(document.querySelector("span"), "textContent").dur(Infinity)
    ))
)));

deck.start();

window.$ = () => { console.log(dump(score.instance)); };

        </script>
    </head>
    <body>
        <p>Frame #<span>0</span></p>
    </body>
</html>
