<!DOCTYPE html>
<html>
    <head>
        <title>Images</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="../test.css">
        <style>

img {
    margin: 4px;
}

        </style>
        <script type="module">

import { Deck } from "../../lib/deck.js";
import { Await, Delay, Element, Event, Effect, Instant, Par, Score, Seq, Try, dump } from "../../lib/score.js";
import { Tape } from "../../lib/tape.js";
import { html, imagePromise, K, range, timeout } from "../../lib/util.js";

const tape = Tape();
const deck = Deck({ tape });
const score = Score({ tape });
const button = document.querySelector("button");

score.add(Seq(
    Event(button, "click").repeat().take(3),
    Effect(() => { button.disabled = true; }),
    Await(async () => await (await fetch("images.json")).json()),
    Seq.map(([w, h]) => Element(html("img", { src: `https://placekitten.com/${w}/${h}` })).dur(500)),
    Effect(() => {
        setTimeout(() => { console.log(dump(score.instance)); });
        return "ok";
    }).dur(100)
));

deck.start();

        </script>
    </head>
    <body>
        <p><a href="../">Back</a></p>
        <p>Fetch images of increasing size, waiting a bit after each one. One image has a wrong URL though!</p>
        <p><button type="button">Begin</button> (press three times!)</p>
    </body>
</html>
