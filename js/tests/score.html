<!DOCTYPE html>
<html>
    <head>
        <title>Score</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="test.css">
        <script type="module">

import { test } from "./test.js";
import { K } from "../lib/util.js";
import { Deck } from "../lib/deck.js";
import { Tape } from "../lib/tape.js";
import { Score, Instant, Delay, dump } from "../lib/score.js";

test("Score()", t => {
    const score = Score();
    t.equal(score.show(), "Score/0", "show");
    t.equal(score.children, [], "no children");
    t.equal(score.tape.show(), "Tape<>", "default tape");
    t.equal(dump(score.instance), "* Score-0 [0, ∞[", "dump matches");
});

test("Score({ tape })", t => {
    const tape = Tape();
    const score = Score({ tape });
    t.equal(score.show(), "Score/0", "show");
    t.equal(score.children, [], "no children");
    t.equal(score.tape, tape, "tape");
    t.equal(dump(score.instance), "* Score-0 [0, ∞[", "dump matches");
});

test("Score.add(child), no deck", t => {
    const score = Score();
    const delay = score.add(Delay(23));
    const instant = score.add(Instant());
    t.equal(instant.show(), "Instant", "show added child");
    t.equal(score.show(), "Score/2", "show after add");
    t.equal(score.children, [delay, instant], "children after add");
    t.equal(delay.parent, score, "parent (1)");
    t.equal(instant.parent, score, "parent (2)");
    t.equal(dump(score.instance),
`* Score-0 [0, ∞[
  * Delay-1 [0, 23[
  * Instant-2 @0`, "children are instantiated");
});

test("Score.add(child), with deck", t => {
    const tape = Tape();
    const deck = Deck({ tape });
    const score = Score({ tape });
    const instant = score.add(Instant(K("ok")));
    deck.now = 17;
    const delay = score.add(Delay(23));
    deck.now = 41;
    t.equal(dump(score.instance),
`* Score-0 [0, ∞[
  * Instant-1 @0 <ok>
  * Delay-2 [17, 40[ <undefined>`, "dump matches");
});

        </script>
    </head>
    <body>
        <p><a href="index.html">Back</a></p>
    </body>
</html>
