<!DOCTYPE html>
<html>
    <head>
        <title>Par.dur</title>
        <meta charset="utf8">
        <link rel="stylesheet" href="test.css">
        <script type="module">

import { test } from "./test.js";
import { K } from "../lib/util.js";
import { Instant, Delay, Par, Seq, dump } from "../lib/score.js";
import { Tape } from "../lib/tape.js";
import { Deck } from "../lib/deck.js";

test("Par(xs).dur(d) duration", t => {
    t.equal(Par().dur(29).duration, 29, "empty par");
    t.equal(
        Par([Delay(51), Delay(23), Delay(31), Delay(17), Delay(19)]).dur(79).duration, 79,
        "dur (more than natural duration)"
    );
    t.equal(
        Par([Delay(51), Delay(23), Delay(31), Delay(17), Delay(19)]).dur(29).duration, 29,
        "dur (less than natural duration)"
    );
    t.equal(
        Par([Delay(51), Delay(23), Delay(31), Par.map(), Par.map()]).dur(29).duration, 29,
        "dur (indefinite natural durations)"
    );
});

test("Extending duration", t => {
    const tape = Tape();
    const par = tape.instantiate(Par([Instant(), Delay(23), Delay(19)]).dur(31), 17);
    t.equal(dump(par),
`* Par-0 [17, 48[
  * Instant-1 @17
  * Delay-2 [17, 40[
  * Delay-3 [17, 36[`, "dump matches");
});

test("Extending duration (but constrained by parent)", t => {
    const tape = Tape();
    const par = tape.instantiate(Par([Instant(), Delay(23), Delay(19)]).dur(51), 17, 31);
    t.equal(dump(par),
`* Par-0 [17, 48[
  * Instant-1 @17
  * Delay-2 [17, 40[
  * Delay-3 [17, 36[`, "dump matches");
});

test("Cutting off duration (failure)", t => {
    const tape = Tape();
    t.undefined(
        tape.instantiate(Par([Instant(), Delay(31), Delay(19)]).dur(23), 17),
        "Par.dur is less than natural duration"
    );
    t.undefined(
        tape.instantiate(Par([Instant(), Delay(31), Delay(19)]), 17, 23),
        "Instantiation dur is less than natural duration"
    );
});

test("Cutting off duration (success with take())", t => {
    const tape = Tape();
    const par = tape.instantiate(Par([Instant(), Delay(31), Delay(19)]).dur(23).take(2), 17);
    t.equal(dump(par),
`* Par-0 [17, 40[
  * Instant-1 @17
  * Delay-2 [17, 36[`, "dump matches");
});

        </script>
    </head>
    <body>
        <p><a href="index.html">Back</a></p>
    </body>
</html>
